@using System.Reflection.Metadata
@using LedgrLogic
@inject NavigationManager NavigationManager
@page "/"

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LEDGR — Sign In</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header" role="banner" aria-label="LEDGR global header">
    <div class="container header-inner">
        <img src="logo-slogan.png" alt="LEDGR — The smart way to balance business." class="brand-logo"/>

        <!-- Optional nav for future pages -->
        <!-- <nav aria-label="Primary">
          <ul class="nav">
            <li><a href="#" aria-current="page">User Management</a></li>
          </ul>
        </nav> -->

    </div>
</header>

<main class="site-main" role="main">
    <section class="auth" aria-labelledby="auth-title">
        <div class="card" role="region" aria-label="Sign in form">
            <h1 id="auth-title" class="auth-title">Sign In</h1>
            <p class="auth-subtitle">Use your email and password.</p>

            <form class="form" action="" method="get" novalidate>
                <div class="field">
                    <label for="email">Username</label>
                    <InputText id="email" name="email" type="email" autocomplete="email" placeholder="Username" required @bind-Value="Username" />
                    <p class="field-help sr-only" id="email-help">Enter your username.</p>
                </div>

                <div class="field">
                    <div class="field-row">
                        <label for="password">Password</label>
                        <a class="link-small" href="/forgot-password">Forgot password?</a>
                    </div>
                    <InputText id="password" name="password" type="password" autocomplete="current-password" placeholder="••••••••" required @bind-Value="Password"/>
                </div>

                <button @onclick="VerifyLoginAsync" type="button" class="btn btn-primary">Sign in</button>

                <p class="footer-line">
                    <span class="muted">Need an account?</span>
                    <NavLink href="/cUser" class="link">Create one</NavLink>
                </p>
                <AntiforgeryToken/>
            </form>
        </div>
    </section>
</main>
</body>

@code {
    public string Username { get; set; } = string.Empty;
    public string Password { get; set; } = string.Empty;

    public void VerifyLoginAsync()
    {
        try
        {
            Task<bool> verify = User.VerifyLogin(Username, Password);
            bool v = verify.Result;
            if (v)
            {
                NavigationManager.NavigateTo($"/home/{Username}");
            }
            else
            {
                // Insert Code to let them know login failed
                // Consider:
                // Create a field aligned to the right, blank text by default, red "invalid username or password" when failed
                // Overwrite input fields with invalidity message
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Process Failed: " + e.Message);
        }

    }

}