@using LedgrLogic

@if (ShowReport)
{
    <style>
    body{
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      min-width: 680px;
      background:linear-gradient(180deg,#f6f8fa,#e9eef8);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    
    .modal-backdrop {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 1000;
    }
    
    .dialog-card {
      background: #ffffff;
      border-radius: 10px;
      overflow: hidden;
      display: grid;
      grid-template-rows: auto 1fr auto;
      width: min(680px, 96%);
      box-shadow: 0 10px 40px rgba(2,6,23,0.2);
    }
    
    .dialog-header{
      padding:18px 20px;
      border-bottom: 1px solid #eef2f7;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    
    .dialog-header h2{
      margin:0;
      font-size:18px;
    }
    
    .dialog-body{
      padding:18px 20px;
    }
    
    form {
      display:grid;
      gap:12px;
    }
    
    label{
      display:block;
      font-size:13px;
      color:#6b7280;
      margin-bottom:6px;
      text-align: left;
    }

</style>
    
    <div class="modal-backdrop">
        <div class="dialog-card">
            <div class="dialog-header">
                <h2>Expired Passwords</h2>
                <button @onclick="Close" aria-label="Close dialog"
                        style="background:none;border:0;font-size:18px;cursor:pointer">âœ•</button>
            </div>

            <div class="dialog-body">
                <table class="pwReport">
                    <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Expired Password</th>
                    </tr>
                    @for (int i = 0; i < Passwords.Count; i += 3)
                    {
                        int index = i;
                        <tr>
                            <td>@Passwords[index+2]</td>
                            <td>@Passwords[index+1]</td>
                        </tr>
                    }
                    </thead>
                </table>
            </div>
        </div>
    </div>
    
}

@code {
    [Parameter] public bool ShowReport { get; set; }
    [Parameter] public EventCallback<bool> ShowChanged { get; set; }

    public List<string> Passwords { get; } = Admin.ExpiredPasswordReport();

    private FormData _formData = new FormData();

    private async Task Close()
    {
        if (ShowChanged.HasDelegate)
            await ShowChanged.InvokeAsync(false);
    }
    
    

    public void ResetForm()
    {
        _formData = new FormData();
    }

    public class FormData
    {
        public string From { get; set; } = string.Empty;
        public string Subject { get; set; } = string.Empty;
        public string Body { get; set; } = string.Empty;
    }
}